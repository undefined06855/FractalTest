<!DOCTYPE html>

<html dir="ltr" lang="en">
    <head>
        <title> Fractal Test </title>

        <style>
            * {
                margin: 0;
                padding: 0;
            }

            canvas {
                position: fixed;
                top: 0;
                left: 0;
            }
        </style>
    </head>

    <body>
        <div>Click in three places to make a Sierpi≈Ñski triangle with 50,000 points (more than three doesn't work so well...).</div>
        <canvas></canvas>

        <script>
            const canvas = document.querySelector("canvas")
                , count = 50_000
                , ctx = canvas.getContext("2d")

            var shapePoints = []

              , lastPos = []
              , hasFirstPoint = false

            canvas.addEventListener("click", event => {
                shapePoints.push([event.offsetX, event.offsetY])
                r()
            })

            function draw()
            {
                num = Math.floor(Math.random() * shapePoints.length)

                if (shapePoints.length != 0)
                    if (!hasFirstPoint)
                    {
                        const firstX = Math.floor(Math.random() * canvas.width)
                            , firstY = Math.floor(Math.random() * canvas.height)
                        
                        lastPos = [firstX, firstY]
                        ctx.fillRect(firstX, firstY, 1, 1)
                        hasFirstPoint = true
                    }
                    else
                    {
                        // Get average between two points
                        const averageX = ( lastPos[0] + shapePoints[num][0] ) / 2
                            , averageY = ( lastPos[1] + shapePoints[num][1] ) / 2

                        lastPos = [averageX, averageY]
                        ctx.fillRect(averageX, averageY, 1, 1)
                    }
            }

            r=()=>{
                canvas.width=window.innerWidth 
                canvas.height=window.innerHeight
                for (var i = 0; i < count; i++) {draw()}
            }

            window.addEventListener("resize",r)
            r()
        </script>
    </body>
</html>
